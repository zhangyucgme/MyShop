<?php if(!function_exists('tpl_block_area')){ require(CORE_DIR.'/admin/smartyplugin/block.area.php'); } if(!function_exists('tpl_block_help')){ require(CORE_DIR.'/admin/smartyplugin/block.help.php'); } ?><form action="index.php?ctl=content/sitemaps&act=update" id="site_map_form" method="post"> <?php $this->_tag_stack[] = array('tpl_block_area', array('inject' => ".mainHead")); tpl_block_area(array('inject' => ".mainHead"), null, $this); ob_start(); ?> <div class="action-bar mainHead clearfix"> <div class="flt"><span class="sysiconBtn addorder" onclick="W.page('index.php?ctl=content/sitemaps&act=addNew')">添加顶级栏目</span><span class="sysiconBtn btn-show-cate" onclick="W.page('index.php?ctl=content/sitemaps&act=index')">全部展开</span><span class="sysiconBtn btn-hide-cate" onclick="W.page('index.php?ctl=content/sitemaps&act=index&p[0]=1')">全部收起</span></div> <div class="frt"><?php $this->_tag_stack[] = array('tpl_block_help', array('docid' => "78",'type' => "link")); tpl_block_help(array('docid' => "78",'type' => "link"), null, $this); ob_start(); ?>点击查看帮助<?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_help($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?></div> </div> <div class='gridlist-head mainHead' style='text-align:center!important'> <div class='span-13' >站点栏目名称</div> <div class='span-1'>显示</div> <div class='span-1'>添加</div> <div class='span-1'>编辑</div> <div class='span-1'>更名</div> <div class='span-1'>删除</div> <div class='span-1'>预览</div> </div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_area($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> <div id="cat_tree" class='gridlist'> <div class="clear_<?php echo $this->_vars['item']['p_node_id']; ?> row"> <div class='row-line'> <div class='span-14'> <div style="margin-left:<?php echo (10+($this->_vars['item']['depth'])*35);?>px;" ><span class="closeFolder" onClick="this.className=(this.className=='openFolder'?'closeFolder':'openFolder');flode('0',this,(this.className=='openFolder'?'none':''));"></span>根目录</div>&nbsp; </div> </div> </div> <?php $this->_env_vars['foreach']["sitemap"]=array('total'=>count($this->_vars['list']),'iteration'=>0);foreach ((array)$this->_vars['list'] as $this->_vars['item']){ $this->_env_vars['foreach']["sitemap"]['first'] = ($this->_env_vars['foreach']["sitemap"]['iteration']==0); $this->_env_vars['foreach']["sitemap"]['iteration']++; $this->_env_vars['foreach']["sitemap"]['last'] = ($this->_env_vars['foreach']["sitemap"]['iteration']==$this->_env_vars['foreach']["sitemap"]['total']);  $this->_vars["nodetype"]=$this->_vars['item']['node_type']; ?> <div class="clear_<?php echo $this->_vars['item']['p_node_id']; ?> row" <?php if( $this->_vars['item']['depth']>0 && $this->_vars['cloasall'] ){ ?>style="display:none"<?php } ?> > <div class='row-line'> <div class='span-13'> <div style="margin-left:<?php echo (30+($this->_vars['item']['depth'])*35);?>px;"><?php if( $this->_vars['item']['depth']>-1 && $this->_vars['item']['child_count'] ){ ?><span class="<?php if( !$this->_vars['cloasall'] ){ ?>closeFolder<?php }else{ ?>openFolder<?php } ?>" onClick="this.className=(this.className=='openFolder'?'closeFolder':'openFolder');flode('<?php echo $this->_vars['item']['node_id']; ?>',$(this),(this.className=='openFolder'?'none':''));" nid="<?php echo $this->_vars['item']['node_id']; ?>"></span> <?php } ?> 排序 <?php $this->_vars["node_id"]=$this->_vars['item']['node_id']; ?> <input class="orderTextStyle" name=p_order[<?php echo $this->_vars['node_id']; ?>] value=<?php echo $this->_vars['item']['p_order']; ?>> <?php if( $this->_vars['nodetype']=='action' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2041px;" /> <?php }elseif( $this->_vars['nodetype']=='articles' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2057px;" /> <?php }elseif( $this->_vars['nodetype']=='custompage' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2073px;" /> <?php }elseif( $this->_vars['nodetype']=='goodpackage' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2089px;" /> <?php }elseif( $this->_vars['nodetype']=='goodsCat' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2105px;" /> <?php }elseif( $this->_vars['nodetype']=='layouts' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2121px;" /> <?php }elseif( $this->_vars['nodetype']=='links' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2137px;" /> <?php }elseif( $this->_vars['nodetype']=='page' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2153px;" /> <?php }elseif( $this->_vars['nodetype']=='pageurl' ){ ?> <img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -2169px;" /> <?php }  if( $this->_vars['item']['editUrl'] ){ ?><a href='<?php echo $this->_vars['item']['editUrl']; ?>' class="lnk" <?php if( $this->_vars['item']['node_type']=="page" ){ ?>target="_blank"<?php } ?> ><?php echo $this->_vars['item']['title']; ?></a><?php }else{  echo $this->_vars['item']['title'];  }  if( $this->_vars['item']['child_count'] ){ ?>(<?php echo $this->_vars['item']['child_count']; ?>)<?php }  if( $this->_vars['item']['node_type']=='articles' ){ ?><a href="index.php?ctl=content/articles&act=addNew&p[0]=<?php echo $this->_vars['item']['node_id']; ?>" style="margin-left:5px;">[添加文章]</a><?php } ?></div> </div> <div class='span-1'><?php if( $this->_vars['item']['hidden'] == "true" ){ ?><a class="opt" href="index.php?ctl=content/sitemaps&act=enableNode&p[0]=<?php echo $this->_vars['item']['node_id']; ?>" ><img src="images/transparent.gif" title="点击显示此栏目" class="imgbundle" style="width:24px;height:16px;background-position:0 -901px;" /></a><?php }else{ ?><a class="opt" href="index.php?ctl=content/sitemaps&act=disableNode&p[0]=<?php echo $this->_vars['item']['node_id']; ?>" ><img src="images/transparent.gif" title="点击隐藏此栏目" class="imgbundle" style="width:24px;height:16px;background-position:0 -2519px;" /></a><?php } ?></div> <div class='span-1'><?php $this->_vars["cat_id"]=$this->_vars['item']['cat_id']; ?><a class="opt" href='index.php?ctl=content/sitemaps&act=addNew&p[0]=<?php echo $this->_vars['item']['node_id']; ?>'><img src="images/transparent.gif" border="0" title="添加子项" class="imgbundle" style="width:16px;height:16px;background-position:0 -0px;" /></a></div> <div class='span-1'><?php if( $this->_vars['item']['editUrl'] ){ ?><a class="opt" class="i" href='<?php echo $this->_vars['item']['editUrl']; ?>' <?php if( $this->_vars['item']['node_type']=="page" ){ ?>target="_blank"<?php } ?>><img src="images/transparent.gif" border="0" alt="编辑" title="编辑" class="imgbundle" style="width:16px;height:16px;background-position:0 -284px;" /></a><?php } ?>&nbsp;</div> <div class='span-1'><a class="opt" href='index.php?ctl=content/sitemaps&act=modify&p[0]=<?php echo $this->_vars['item']['node_id']; ?>'><img src="images/transparent.gif" border="0" title="更名" class="imgbundle" style="width:16px;height:16px;background-position:0 -1655px;" /></a></div> <div class='span-1'><span class="opt" onClick="if(window.confirm('是否确认删除'))deleteSiteMapRow(<?php echo $this->_vars['item']['node_id']; ?>,event)"><img src="images/transparent.gif" border="0" title="删除" class="imgbundle" style="width:16px;height:16px;background-position:0 -214px;" /></span></div> <div class='span-1'><a class="opt" href='<?php echo $this->_vars['item']['link']; ?>' target="blank"><img src="images/transparent.gif" border="0" title="预览" class="imgbundle" style="width:18px;height:19px;background-position:0 -2535px;" /></a></div> </div> </div> <?php } unset($this->_env_vars['foreach']["sitemap"]); ?> </div> <?php $this->_tag_stack[] = array('tpl_block_area', array('inject' => ".mainFoot")); tpl_block_area(array('inject' => ".mainFoot"), null, $this); ob_start(); ?> <div class="mainFoot"> <div class="footer"> <table cellspacing="0" cellpadding="0" border="0" align="center" class="table-action"> <tr> <td><b class="submitBtn"> <input onclick="$('site_map_form').fireEvent('submit',{stop:$empty})" type="submit" value="保存排序" /> </b></td> </tr> </table> </div> </div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_area($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> </form> <script>
function flode(nid,target,visible){
    $ES('#site_map_form .clear_'+nid).each(function(e){
        e.setStyle('display',visible);
        if(visible=='none'){
            var dv=e.getElement('span[nid]');
            if(dv){
                flode(dv.get('nid'),e.getElement('span'),visible);
            }
        }else{
            var dv=e.getElement('span[nid]');
            if(dv){
                flode(dv.get('nid'),e.getElement('span'),((e.getElement('span').className=="openFolder")?'none':''));
            }
        }
    });
}

function deleteSiteMapRow(id,e){
    e=new Event(e).stop();
    W.page("index.php?ctl=content/sitemaps&act=toRemove&p[0]="+id,{update:'messagebox',method:'get',onComplete:function(re){
         if(re.contains('successSplash')){
            $(e.target).getParent('.row').remove();
         }
    }})

}



</script> 