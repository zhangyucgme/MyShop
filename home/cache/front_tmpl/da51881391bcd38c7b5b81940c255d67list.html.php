<?php if(!function_exists('tpl_block_area')){ require(CORE_DIR.'/admin/smartyplugin/block.area.php'); } if(!function_exists('tpl_block_safehtml')){ require(CORE_DIR.'/include_v5/smartyplugins/block.safehtml.php'); } if(!function_exists('tpl_modifier_escape')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.escape.php'); }  $this->_tag_stack[] = array('tpl_block_area', array('inject' => ".mainHead")); tpl_block_area(array('inject' => ".mainHead"), null, $this); ob_start();  if( $this->_vars['_finder']['listViews'] ){ ?> <div id="finder-header-<?php echo $this->_vars['_finder']['_name']; ?>" class="finder-header"> <?php } ?> <button title="列表项配置" type="button" onclick="<?php echo "new Dialog('index.php?ctl={$_GET['ctl']}&act=colsetting',{width:350,title:'编辑列表项',onClose:{$this->_vars['_finder']['var']}.refresh.bind({$this->_vars['_finder']['var']})})";?>" class="btn finder-col-options"><span><span><img src="images/transparent.gif" class="imgbundle icon" style="width:16px;height:16px;background-position:0 -1527px;" /></span></span></button> <table width="100%" cellpadding="0" cellspacing="0"> <!----cols----> <col style="width:24px" class="span-select"></col> <?php if( $this->_vars['_finder']['detail_url'] && $_GET['act']!="recycleIndex" ){ ?> <col style="width:48px"></col> <?php }  $this->_env_vars['foreach']["finderCol"]=array('total'=>count($this->_vars['items']['cols']),'iteration'=>0);foreach ((array)$this->_vars['items']['cols'] as $this->_vars['key'] => $this->_vars['col']){ $this->_env_vars['foreach']["finderCol"]['first'] = ($this->_env_vars['foreach']["finderCol"]['iteration']==0); $this->_env_vars['foreach']["finderCol"]['iteration']++; $this->_env_vars['foreach']["finderCol"]['last'] = ($this->_env_vars['foreach']["finderCol"]['iteration']==$this->_env_vars['foreach']["finderCol"]['total']); ?> <col style="width:<?php echo $this->_vars['col']['width']; ?>px" <?php if( $this->_vars['_finder']['order'][0]==$this->_vars['col'] ){ ?>class="orderCell"<?php } ?>></col> <?php } unset($this->_env_vars['foreach']["finderCol"]); ?> <col></col> <!----cols----> <thead> <tr> <?php if( $_GET['ctl'] != "member/advance" ){ ?> <td><input type="checkbox" class="sellist" name="<?php echo $this->_vars['_finder']['id']; ?>[]" onclick='this.blur()'/></td> <?php }else{ ?> <td class="sellist"></td> <?php }  if( $this->_vars['_finder']['detail_url'] ){ ?> <td style="width:48px">&nbsp;查看</td> <?php }  $this->_env_vars['foreach']["finderCol"]=array('total'=>count($this->_vars['items']['cols']),'iteration'=>0);foreach ((array)$this->_vars['items']['cols'] as $this->_vars['key'] => $this->_vars['col']){ $this->_env_vars['foreach']["finderCol"]['first'] = ($this->_env_vars['foreach']["finderCol"]['iteration']==0); $this->_env_vars['foreach']["finderCol"]['iteration']++; $this->_env_vars['foreach']["finderCol"]['last'] = ($this->_env_vars['foreach']["finderCol"]['iteration']==$this->_env_vars['foreach']["finderCol"]['total']); ?> <td> <?php if( $this->_vars['_finder']['order'][0]==$this->_vars['key'] ){ ?> <div class="cell highlight-<?php if( $this->_vars['_finder']['order'][1]=='desc' ){ ?>down<?php }else{ ?>up<?php } ?> borderdown orderable" key="<?php echo $this->_vars['key']; ?>" order="<?php echo $this->_vars['_finder']['order'][1]; ?>"> <?php }elseif( $this->_vars['col']['noOrder'] ){ ?> <div class="cell"> <?php }else{  if( $this->_vars['key'] != '_cmd' ){ ?> <div class="cell orderable" key="<?php echo $this->_vars['key']; ?>"> <?php }  } ?> <table width="100%" cellpadding="0" cellspacing="0"> <tr> <td> <span class='finder-col-label'><?php echo $this->_vars['col']['label']; ?></span> </td> <td width='5px'> <span class="finder-col-resizer" title='拖动改变列宽' onclick='new Event(event).stopPropagation()'>列宽</span> </td> </tr> </table> </div> </td> <?php } unset($this->_env_vars['foreach']["finderCol"]); ?> <td>&nbsp;</td> </tr> </thead> </table> <?php if( $this->_vars['_finder']['listViews'] ){ ?> </div> <?php }  $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_area($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_safehtml', array()); tpl_block_safehtml(array(), null, $this); ob_start();  $this->_vars["finderId"]=$this->_vars['_finder']['var']; ?> <div class="finder-list finder-list-normal" id="finder-list-<?php echo $this->_vars['_finder']['_name']; ?>"> <?php if( $this->_vars['sql_error'] ){ ?> <div class="error" style="margin:20px;-moz-border-radius:5px;-webkit-border-radius:5px;radius:5px"><b>发现数据库结构存在错误.</b><button onclick="W.page('index.php?ctl=system/debug&act=check_database')" type="button" class="btn"><span><span>自动修复</span></span></button><hr /> <p><?php echo $this->_vars['sql_error']; ?></p></div> <?php }elseif( $this->_vars['items']['list'] ){ ?> <table width="100%" cellpadding="0" cellspacing="0"> <!----cols----> <col style="width:24px" class="span-select"></col> <?php if( $this->_vars['_finder']['detail_url'] && $_GET['act']!="recycleIndex" ){ ?> <col style="width:48px"></col> <?php }  $this->_env_vars['foreach']["finderCol"]=array('total'=>count($this->_vars['items']['cols']),'iteration'=>0);foreach ((array)$this->_vars['items']['cols'] as $this->_vars['key'] => $this->_vars['col']){ $this->_env_vars['foreach']["finderCol"]['first'] = ($this->_env_vars['foreach']["finderCol"]['iteration']==0); $this->_env_vars['foreach']["finderCol"]['iteration']++; $this->_env_vars['foreach']["finderCol"]['last'] = ($this->_env_vars['foreach']["finderCol"]['iteration']==$this->_env_vars['foreach']["finderCol"]['total']); ?> <col style="width:<?php echo $this->_vars['col']['width']; ?>px" idx="<?php echo $this->_env_vars['foreach']['finderCol']['iteration']; ?>" <?php if( $this->_vars['_finder']['order'][0]==$this->_vars['col'] ){ ?>class="orderCell"<?php } ?>></col> <?php } unset($this->_env_vars['foreach']["finderCol"]); ?> <col></col> <!----cols----> <tbody> <?php $this->_env_vars['foreach']["_finder"]=array('total'=>count($this->_vars['items']['list']),'iteration'=>0);foreach ((array)$this->_vars['items']['list'] as $this->_vars['item']){ $this->_env_vars['foreach']["_finder"]['first'] = ($this->_env_vars['foreach']["_finder"]['iteration']==0); $this->_env_vars['foreach']["_finder"]['iteration']++; $this->_env_vars['foreach']["_finder"]['last'] = ($this->_env_vars['foreach']["_finder"]['iteration']==$this->_env_vars['foreach']["_finder"]['total']); ?> <tr class="<?php if( $this->_vars['item']['highlight'] ){ ?>highlight-row <?php } ?>row<?php if( $this->_env_vars['foreach']['_finder']['iteration'] %2==0 ){ ?> even<?php } ?>" item-id="<?php echo $this->_vars['item'][$this->_vars['_finder']['id']]; ?>"> <?php if( $_GET['ctl'] != "member/advance" ){ ?> <td><input type="checkbox" tags="<?php echo tpl_modifier_escape($this->_vars['item']['_tags'],"html"); ?>" class="sel" name="<?php echo $this->_vars['_finder']['id']; ?>[]" value="<?php echo $this->_vars['item'][$this->_vars['_finder']['id']]; ?>"></td> <?php }else{ ?> <td><input type="hidden" class="sel"></td> <?php }  if( $this->_vars['_finder']['detail_url'] ){ ?> <td class="finder-list-command"> <span title="展开查看" class="btn-detail-open" detail="index.php?ctl=<?php echo $_GET['ctl']; ?>&act=detail&p[0]=<?php echo $this->_vars['item'][$this->_vars['_finder']['id']]; ?>" > <img src="images/transparent.gif"/> </span> <a title="在新窗口查看" href="index.php?ctl=<?php echo $_GET['ctl']; ?>&act=detail&p[0]=<?php echo $this->_vars['item'][$this->_vars['_finder']['id']]; ?>" target="_blank"><img src="images/transparent.gif" class="imgbundle" style="width:16px;height:16px;background-position:0 -1811px;" /></a> </td> <?php }  foreach ((array)$this->_vars['items']['cols'] as $this->_vars['col'] => $this->_vars['colItem']){ ?> <td key="<?php echo $this->_vars['col']; ?>"<?php if( $this->_vars['colItem']['editable'] && $_GET['act']!="recycleIndex" ){ ?> class="editable"<?php } ?>><div class="cell"> <?php if( $this->_vars['colItem']['html'] ){  $_tpl_tpl_vars = $this->_vars; echo $this->_fetch_compile_include($this->_vars['colItem']['html'], array()); $this->_vars = $_tpl_tpl_vars; unset($_tpl_tpl_vars);  }else{  echo ((isset($this->_vars['item'][$this->_vars['col']]) && ''!==$this->_vars['item'][$this->_vars['col']])?$this->_vars['item'][$this->_vars['col']]:'-');  } ?> </div></td> <?php } ?> <td>&nbsp;</td> </tr> <?php } unset($this->_env_vars['foreach']["_finder"]); ?> </tbody> </table> <?php }else{ ?> <div style="margin:20px;border:1px solid #999;background:#f0f0f0;padding:20px;-moz-border-radius:5px;-webkit-border-radius:5px;radius:5px">没有符合条件的条目.</div> <?php } ?> <div id='finder-list-col-editpanel' style='visilibity:hidden;overflow:hidden;' class='finder-list-col-editpanel' onclick='new Event(event).stopPropagation()'></div> </div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_safehtml($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?>