<?php if(!function_exists('tpl_block_area')){ require(CORE_DIR.'/admin/smartyplugin/block.area.php'); } if(!function_exists('tpl_block_help')){ require(CORE_DIR.'/admin/smartyplugin/block.help.php'); } if(!function_exists('tpl_modifier_size')){ require(CORE_DIR.'/admin/smartyplugin/modifier.size.php'); } if(!function_exists('tpl_modifier_cut')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.cut.php'); } if(!function_exists('tpl_modifier_cdate')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.cdate.php'); }  $this->_tag_stack[] = array('tpl_block_area', array('inject' => '.mainHead')); tpl_block_area(array('inject' => '.mainHead'), null, $this); ob_start(); ?> <div class="clearfix ColColorGray borderup"> <?php if( $this->_vars['currentTheme']['name'] ){ ?> <h4>正在使用的模板<?php $this->_tag_stack[] = array('tpl_block_help', array('docid' => "77",'type' => "link")); tpl_block_help(array('docid' => "77",'type' => "link"), null, $this); ob_start(); ?>点击查看帮助<?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_help($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?></h4> <table width="100%" border="0" cellpadding="0" cellspacing="0"> <tr> <td valign="top" style="padding:5px; vertical-align:top" width="160"> <img id="<?php echo $this->_vars['currentTheme']['theme']; ?>_img"style="padding:3px;border-top: 2px solid #eee;border-left: 2px solid #eee; border-right: 2px solid #bec6ce;border-bottom: 2px solid #bec6ce;" src="index.php?ctl=system/template&act=previewImg&p[0]=<?php echo $this->_vars['currentTheme']['theme']; ?>" width="120" height="160"/> <div class="template-color"> <?php if( $this->_vars['currentTheme']['config']['config'] ){  foreach ((array)$this->_vars['currentTheme']['config']['config'] as $this->_vars['key'] => $this->_vars['c_info']){  if( $this->_vars['c_info'][type]=='fullstyle' ){ ?> <span class="template-color-item" <?php if( $this->_vars['c_info'][value]==$this->_vars['selected_css'] ){ ?>style="border:2px solid #336699;"<?php } ?>><span title="<?php echo $this->_vars['c_info'][label]; ?>" onMouseOver="$('<?php echo $this->_vars['currentTheme']['theme']; ?>_img').src='index.php?ctl=system/template&act=previewImg&p[0]=<?php echo $this->_vars['currentTheme']['theme']; ?>&p[1]=<?php echo $this->_vars['c_info'][preview]; ?>'" onClick="W.page('index.php?ctl=system/template&act=setColor&p[0]=<?php echo $this->_vars['currentTheme']['theme']; ?>&p[1]=<?php echo $this->_vars['c_info'][value]; ?>')" style="background-color: <?php echo $this->_vars['c_info'][color]; ?>;"></span></span> <?php }  }  } ?></div> </td> <td width="200" valign="top" style="padding:5px; vertical-align:top"><h4><?php echo $this->_vars['currentTheme']['name']; ?>(<?php echo $this->_vars['currentTheme']['version']; ?>)</h4> <ul class="info"> <li>作者<a href="<?php echo $this->_vars['currentTheme']['site']; ?>" target="_blank"><?php echo $this->_vars['currentTheme']['author']; ?></a></li> </ul> <?php echo $this->_vars['currentTheme']['desc']; ?> <div class="template-options"> <a class="sysiconBtnNoIcon" href="index.php?ctl=system/template&act=edit&p[0]=<?php echo $this->_vars['currentTheme']['theme']; ?>">编辑模板</a> <a class="sysiconBtnNoIcon" href='index.php?ctl=system/tmpimage&act=index&theme=<?php echo $this->_vars['currentTheme']['theme']; ?>&istheme=1'>模板文件管理</a> </div> </td> <td><iframe src="<?php echo $this->_vars['install_url']; ?>/adminintro.html" width="500" height="182" scrolling="no" frameborder="0"></iframe> </td> </tr> </table> <?php }else{ ?> <div class="error"> 当前应用的模板<?php echo $this->_vars['currentTheme']['theme']; ?>不存在！请重新设置！ </div> <?php } ?> <table border="0" cellspacing="0" cellpadding="0" style="width:auto"> <tr> <td><h4>其他可供使用的模板</h4></td> <td><?php if( $this->_vars['cantUploadMsg']=='writeable' ){ ?> 因为模板目录无法写入，因此无法通过后台直接上传模板包。 <?php }else{ ?> <table><tr> <td> <button type="button" id="fix_fl10upload_panel" style="float:left;" class="btn"><span><span><img src="images/transparent.gif" class="imgbundle icon" style="width:15px;height:16px;background-position:0 -133px;" />上传模板</span></span></button> </td><td> <button type="button" onclick="<?php echo " new Dialog('{$this->_vars['install_url']}#http://{$_SERVER['HTTP_HOST']}{$_SERVER['PHP_SELF']}?ctl={$_GET['ctl']}&act=install_online', {frameable:true,title:'在线安装模板',onClose:function(){ W.page('index.php?ctl=system/template&act=index'); }})";?>" class="btn"><span><span>在线安装模板</span></span></button><sup class='font10px fontcolorRed'>NEW</sup> </td></tr></table> </div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_area($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> <div id="template"> <div class="template-list"> <div class="tableform clearfix "> <script language="javascript">
function install_template_click_handle(){

}


new Swiff.Uploader( { 
            verbose: true,
			url:'index.php?ctl=system/template&act=upload&sess_id='+sess_id,
            path: 'images/uploader.swf',
            typeFilter: {
                'Images (*.tgz, *.tar.gz, *.theme)': '*.tgz;*.tar.gz;*.theme'
            },
            fileSizeMax:5242880,
            target:'fix_fl10upload_panel',
            onSelectFail:function(rs){
               rs.each(function(v){
                    if(v.validationError=='sizeLimitMax'){
                        alert(v.name+'\n\n文件超出大小限制');
                    };
                });			
            },
            onSelectSuccess:function(rs){       
				rs.each(function(v,i){
					new Element('div',{'class':'item',id:'uping-'+v.id}).inject($('all-themes'));
					$('uping-'+v.id).setHTML('<div class="progress-bar" style="width:100px"><i>&nbsp;</i></div><center>0%</center>');
			    });   
                this.start();                 
            },
            onFileOpen:function(e){  
				$('uping-'+e.id).getElement('center').set('text','生成中...');
            },
            onFileProgress:function(e){
                var pt=Number(e.progress.bytesLoaded*100/e.size).toFixed()+'%';  
				   $('uping-'+e.id).getElement('i').setStyle('width',pt);
                    $('uping-'+e.id).getElement('center').set('text',pt);
                
            },		
            onFileComplete: function(res){	
               if(res.response.error){
                    return  new MessageBox('文件'+res.name+'上传失败',{type:'error',autohide:true});
               }
			   $('uping-'+res.id).setHTML(res.response.text);
			  
            }
 });	
  </script> <?php } ?></td> </tr> </table> <div id="all-themes"> <?php $this->_env_vars['foreach'][theme]=array('total'=>count($this->_vars['themes']),'iteration'=>0);foreach ((array)$this->_vars['themes'] as $this->_vars['theme']){ $this->_env_vars['foreach'][theme]['first'] = ($this->_env_vars['foreach'][theme]['iteration']==0); $this->_env_vars['foreach'][theme]['iteration']++; $this->_env_vars['foreach'][theme]['last'] = ($this->_env_vars['foreach'][theme]['iteration']==$this->_env_vars['foreach'][theme]['total']);  if( $this->_vars['theme']['name'] ){ ?> <div class="item"> <table border="0" cellspacing="0" cellpadding="0"> <tr> <td align="center" valign="top"> <div class="template-img"><img id="<?php echo $this->_vars['theme']['theme']; ?>_img" src="index.php?ctl=system/template&act=previewImg&p[0]=<?php echo $this->_vars['theme']['theme']; ?>" width="120" height="160" /> <div> <div class="template-color"> <?php if( $this->_vars['theme']['config'] ){  foreach ((array)$this->_vars['theme']['config']['config'] as $this->_vars['key'] => $this->_vars['c_info']){  if( $this->_vars['c_info'][type]=='fullstyle' ){ ?> <span class="template-color-item"><span title="<?php echo $this->_vars['c_info'][label]; ?>" onMouseOver="$('<?php echo $this->_vars['theme']['theme']; ?>_img').src='index.php?ctl=system/template&act=previewImg&p[0]=<?php echo $this->_vars['theme']['theme']; ?>&p[1]=<?php echo $this->_vars['c_info'][preview]; ?>'" style="background-color: <?php echo $this->_vars['c_info'][color]; ?>;"></span></span> <?php }  }  } ?></div> <a href="index.php?ctl=system/template&act=setDefault&p[0]=<?php echo $this->_vars['theme']['theme']; ?>" class="sysiconBtnNoIcon">使用模板</a> <?php if( !constant('SAAS_MODE') ){ ?> <a href="index.php?ctl=system/template&act=edit&p[0]=<?php echo $this->_vars['theme']['theme']; ?>" class="sysiconBtnNoIcon">编辑</a> <a href="<?php echo $this->_vars['base_url']; ?>?previewtheme-<?php echo $this->_vars['theme']['theme']; ?>-index.html" class="sysiconBtnNoIcon" target="_blank">预览</a> <?php }else{ ?> <a target="download" href="index.php?ctl=system/template&act=dlpkg&p[0]=<?php echo $this->_vars['theme']['theme']; ?>" class="sysiconBtnNoIcon">下载</a> <?php } ?><span class="sysiconBtnNoIcon" onClick="void function(themeitem){ if(window.confirm('删除后将无法恢复，确认删除吗？')){ W.page('index.php?ctl=system/template&act=remove&p[0]=<?php echo $this->_vars['theme']['theme']; ?>',{update:'messagebox',onComplete:function(){themeitem.remove()}}); }}($(this).getParent('.item'))">删除</span></div> <!-- <ul class="info widgets"> <li style="color:#666" ><?php echo $this->_vars['theme']['info']; ?></li> <li>占用空间：<?php echo tpl_modifier_size($this->_vars['theme']['size']); ?></li> <li>使用到的版块：</li> <?php if( count($this->_vars['theme']['widgets'])>0 ){  echo $this->_vars['theme']['widget'];  foreach ((array)$this->_vars['theme']['widgets'] as $this->_vars['widget']){  if( $this->_vars['widget']['installed'] ){  echo $this->_vars['widget']['name']; ?> | <?php }else{ ?><span style="color:red">缺失:<?php echo $this->_vars['widget']['name']; ?></span> | <?php }  }  } ?> </ul> --> </div> <h5 style="margin:0; height:20px; padding:0"><?php echo tpl_modifier_cut($this->_vars['theme']['name'],16); ?>(<?php echo tpl_modifier_cut($this->_vars['theme']['version'],20); ?>)</h5> <span style="color:#999; font-size:11px; font-weight:normal;"><a href="<?php echo $this->_vars['theme']['site']; ?>" target="_blank"><?php echo tpl_modifier_cut($this->_vars['theme']['author'],20); ?></a>| <?php echo tpl_modifier_cdate($this->_vars['theme']['stime']); ?></span> </td> </tr> </table> </div> <?php }  } unset($this->_env_vars['foreach'][theme]); ?> </div> </div> </div> </div> 