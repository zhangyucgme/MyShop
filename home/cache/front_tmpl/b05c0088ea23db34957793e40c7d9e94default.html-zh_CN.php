<?php if(!function_exists('tpl_block_capture')){ require(CORE_DIR.'/include_v5/smartyplugins/block.capture.php'); } if(!function_exists('tpl_function_link')){ require(CORE_DIR.'/include_v5/smartyplugins/function.link.php'); } if(!function_exists('tpl_modifier_storager')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.storager.php'); } if(!function_exists('tpl_modifier_escape')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.escape.php'); } if(!function_exists('tpl_modifier_cut')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.cut.php'); } if(!function_exists('tpl_modifier_styleset')){ require(CORE_DIR.'/include_v5/smartyplugins/modifier.styleset.php'); } if(!function_exists('tpl_function_goodsmenu')){ require(CORE_DIR.'/include_v5/smartyplugins/function.goodsmenu.php'); } $CURRENCY = &$this->system->loadModel('system/cur'); ?><style> .itemsWrap{ *display:block; float:left; overflow:hidden; } </style> <input type="hidden" name="goods_num" id="goods_num" value="<?php echo $this->_vars['data']['goods_num']; ?>"> <?php $this->_tag_stack[] = array('tpl_block_capture', array('name' => titleImg)); tpl_block_capture(array('name' => titleImg), null, $this); ob_start(); ?> <div class="titleImg"><a href="<?php if( $this->_vars['setting']['titleImgHref'] ){  echo $this->_vars['setting']['titleImgHref'];  }else{  echo tpl_function_link(array('ctl' => gallery,'act' => $this->_vars['setting']['view'],'arg0' => $this->_vars['setting']['id']), $this); } ?>"><img src="<?php echo $this->_vars['setting']['titleImgSrc']; ?>" title="<?php echo $this->_vars['setting']['titleImgAlt']; ?>"/></a></div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsCat)); tpl_block_capture(array('name' => goodsCat), null, $this); ob_start();  if( $this->_vars['setting']['showTitle']=="on" ){ ?> <h4><?php echo $this->_vars['setting']['titleDesc']; ?></h4> <?php }  $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsLoop)); tpl_block_capture(array('name' => goodsLoop), null, $this); ob_start();  $this->_env_vars['foreach'][goodslist]=array('total'=>count($this->_vars['data']['goods']),'iteration'=>0);foreach ((array)$this->_vars['data']['goods'] as $this->_vars['key'] => $this->_vars['goods_data']){ $this->_env_vars['foreach'][goodslist]['first'] = ($this->_env_vars['foreach'][goodslist]['iteration']==0); $this->_env_vars['foreach'][goodslist]['iteration']++; $this->_env_vars['foreach'][goodslist]['last'] = ($this->_env_vars['foreach'][goodslist]['iteration']==$this->_env_vars['foreach'][goodslist]['total']);  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsImg)); tpl_block_capture(array('name' => goodsImg), null, $this); ob_start();  if( $this->_vars['setting']['showGoodsImg']=="on" ){ ?><div class="goodsImg" style="overflow:hidden;text-align:center;vertical-align: middle;<?php if( $this->_vars['setting']['goodsImgWidth'] ){ ?>width:<?php echo $this->_vars['setting']['goodsImgWidth']; ?>px;<?php }elseif( $this->_env_vars['thumbnail_pic_width'] ){ ?>width:<?php echo $this->_env_vars['thumbnail_pic_width']; ?>px;<?php }  if( $this->_vars['setting']['goodsImgHeight'] ){ ?>height:<?php echo $this->_vars['setting']['goodsImgHeight']; ?>px;<?php }elseif( $this->_env_vars['thumbnail_pic_height'] ){ ?>height:<?php echo $this->_env_vars['thumbnail_pic_height']; ?>px;<?php } ?>"><a href="<?php echo tpl_function_link(array('ctl' => "product",'act' => "index",'arg0' => $this->_vars['goods_data']['goods_id']), $this);?>" target="_blank" title="<?php echo $this->_vars['goods_data']['name']; ?>"><img <?php if( $this->_vars['setting']['restrict']=='off' ){  if( $this->_vars['setting']['goodsImgWidth'] ){ ?>width="<?php echo $this->_vars['setting']['goodsImgWidth']; ?>"<?php }  if( $this->_vars['setting']['goodsImgHeight'] ){ ?>height="<?php echo $this->_vars['setting']['goodsImgHeight']; ?>"<?php }  } ?> src="<?php echo tpl_modifier_storager(((isset($this->_vars['goods_data']['thumbnail_pic']) && ''!==$this->_vars['goods_data']['thumbnail_pic'])?$this->_vars['goods_data']['thumbnail_pic']:$this->system->getConf('site.default_thumbnail_pic'))); ?>" title="<?php echo $this->_vars['goods_data']['name']; ?>"></a></div><?php }  $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsName)); tpl_block_capture(array('name' => goodsName), null, $this); ob_start();  if( $this->_vars['setting']['showGoodsName']=="on" ){ ?> <h6><a href="<?php echo tpl_function_link(array('ctl' => "product",'act' => "index",'arg0' => $this->_vars['goods_data']['goods_id']), $this);?>" target="_blank" title="<?php echo tpl_modifier_escape($this->_vars['goods_data']['name'],html); ?>"><?php echo tpl_modifier_cut($this->_vars['goods_data']['name'],$this->_vars['setting']['max_length']); ?></a></h6> <?php }  $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content='';  $this->_tag_stack[] = array('tpl_block_capture', array('name' => goodsDesc)); tpl_block_capture(array('name' => goodsDesc), null, $this); ob_start();  if( $this->_vars['setting']['showGoodsDesc']=="on" ){ ?> <ul> <?php $this->_vars["savePC"]=$this->_vars['goods_data']['mktprice']-$this->_vars['goods_data']['price'];  if( $this->_vars['setting']['showGoodsMktPrice']=="on" ){ ?><li><span class="mktprice0"></span><span class="mktprice1" style="color:<?php echo $this->_vars['setting']['color1']; ?>;<?php echo tpl_modifier_styleset($this->_vars['setting']['mark_font']); ?>"><?php echo ((isset($this->_vars['setting']['mktPriceText']) && ''!==$this->_vars['setting']['mktPriceText'])?$this->_vars['setting']['mktPriceText']:'市场价');  echo ((isset($this->_vars['setting']['mktPriceSep']) && ''!==$this->_vars['setting']['mktPriceSep'])?$this->_vars['setting']['mktPriceSep']:':');  echo $CURRENCY->changer($this->_vars['goods_data']['mktprice']); ?></span></li><?php }  if( $this->_vars['setting']['showGoodsPrice']=="on" ){ ?><li><span class="price0"><?php echo ((isset($this->_vars['setting']['priceText']) && ''!==$this->_vars['setting']['priceText'])?$this->_vars['setting']['priceText']:'销售价');  echo ((isset($this->_vars['setting']['priceSep']) && ''!==$this->_vars['setting']['priceSep'])?$this->_vars['setting']['priceSep']:':'); ?></span><span class="price1" style="color:<?php echo $this->_vars['setting']['color2']; ?>;<?php echo tpl_modifier_styleset($this->_vars['setting']['member_font']); ?>"><?php echo $CURRENCY->changer($this->_vars['goods_data']['price']); ?></span></li><?php }  if( $this->_vars['savePC']>0 && $this->_vars['setting']['showGoodsSave']=="on" ){ ?><li><span class="save0"><?php echo ((isset($this->_vars['setting']['saveText']) && ''!==$this->_vars['setting']['saveText'])?$this->_vars['setting']['saveText']:'节省');  echo ((isset($this->_vars['setting']['saveSep']) && ''!==$this->_vars['setting']['saveSep'])?$this->_vars['setting']['saveSep']:':'); ?></span><span class="save1" style="color:<?php echo $this->_vars['setting']['color3']; ?>;<?php echo tpl_modifier_styleset($this->_vars['setting']['save_font']); ?>"><?php echo $CURRENCY->changer($this->_vars['savePC']); ?></span></li><?php }  if( $this->_vars['setting']['showGoodsInfo']=="on" && $this->_vars['goods_data']['brief'] ){ ?><li><span class="info0">简介：<?php echo $this->_vars['goods_data']['brief']; ?></span></li><?php }  if( $this->_vars['setting']['showCount']=="on" ){ ?><li><span class="countprice"><?php echo ((isset($this->_vars['setting']['countText']) && ''!==$this->_vars['setting']['countText'])?$this->_vars['setting']['countText']:'折扣'); ?></span><span class="info1" style="color:<?php echo $this->_vars['setting']['color5']; ?>;<?php echo tpl_modifier_styleset($this->_vars['setting']['count_font']); ?>"><?php $this->_vars["aCount"]=$this->_vars['goods_data']['price']/$this->_vars['goods_data']['mktprice']*100;  echo number_format($this->_vars['aCount'],"");  echo ((isset($this->_vars['setting']['countSep']) && ''!==$this->_vars['setting']['countSep'])?$this->_vars['setting']['countSep']:':'); ?></span></li><?php } ?> </ul> <?php if( $this->_vars['setting']['showBuyArea']=="on" ){ ?> <ul class="button"> <?php echo tpl_function_goodsmenu(array('product' => $this->_vars['goods_data']), $this);?> </ul> <?php }  }  $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> <div class="itemsWrap <?php if( $this->_vars['setting']['column'] > 1 &&($this->_env_vars['foreach']['goodslist']['iteration'] % ((isset($this->_vars['setting']['column']) && ''!==$this->_vars['setting']['column'])?$this->_vars['setting']['column']:4)) == 0 ){ ?>last<?php } ?>" product="<?php echo $this->_vars['goods_data']['goods_id']; ?>" style="width:<?php echo (floor(99/(((isset($this->_vars['setting']['column']) && ''!==$this->_vars['setting']['column'])?$this->_vars['setting']['column']:4))));?>%;"> <div class="item"> <?php if( $this->_vars['setting']['showGoodsImg']=="off" ){  echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsDesc'];  }elseif( $this->_vars['setting']['showGoodsName']=="off" && $this->_vars['setting']['showGoodsDesc']=="off" ){  echo $this->_env_vars['capture']['goodsImg'];  }elseif( $this->_vars['setting']['goodsImgPosition']=="top" ){  echo $this->_env_vars['capture']['goodsImg'];  echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsDesc'];  }elseif( $this->_vars['setting']['goodsImgPosition']=="center" ){  echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsImg'];  echo $this->_env_vars['capture']['goodsDesc'];  }elseif( $this->_vars['setting']['goodsImgPosition']=="bottom" ){  echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsDesc'];  echo $this->_env_vars['capture']['goodsImg'];  }elseif( $this->_vars['setting']['goodsImgPosition']=="left" ){ ?> <table width="100%" border="0" cellspacing="0" cellpadding="0"> <tr> <td><?php echo $this->_env_vars['capture']['goodsImg']; ?></td> <td class="goodsDesc"> <?php echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsDesc']; ?> </td> </tr> </table> <?php }elseif( $this->_vars['setting']['goodsImgPosition']=="right" ){ ?> <table width="100%" border="0" cellspacing="0" cellpadding="0"> <tr> <td class="goodsDesc"> <?php echo $this->_env_vars['capture']['goodsName'];  echo $this->_env_vars['capture']['goodsDesc']; ?> </td> <td><?php echo $this->_env_vars['capture']['goodsImg']; ?></td> </tr> </table> <?php } ?> </div> </div> <?php if( $this->_vars['setting']['column']!=1 &&($this->_env_vars['foreach']['goodslist']['iteration'] % ((isset($this->_vars['setting']['column']) && ''!==$this->_vars['setting']['column'])?$this->_vars['setting']['column']:4)) == 0 ){ ?> <div class="clear"></div> <?php }  } unset($this->_env_vars['foreach'][goodslist]); ?> <div class="clear"></div> <?php $_block_content = ob_get_contents(); ob_end_clean(); $_block_content = tpl_block_capture($this->_tag_stack[count($this->_tag_stack) - 1][1], $_block_content, $this); echo $_block_content; array_pop($this->_tag_stack); $_block_content=''; ?> <div class="GoodsListWrap"> <?php if( $this->_vars['setting']['showTitleImg']=="off" ){ ?> <div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['goodsLoop']; ?> </div> <?php }elseif( $this->_vars['setting']['titleImgPosition']=="top" ){  echo $this->_env_vars['capture']['titleImg']; ?> <div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['goodsLoop']; ?> </div> <?php }elseif( $this->_vars['setting']['titleImgPosition']=="center" ){  echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['titleImg']; ?> <div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsLoop']; ?> </div> <?php }elseif( $this->_vars['setting']['titleImgPosition']=="bottom" ){ ?> <div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['goodsLoop']; ?> </div> <?php echo $this->_env_vars['capture']['titleImg'];  }elseif( $this->_vars['setting']['titleImgPosition']=="left" ){ ?> <table width="100%" border="0" cellspacing="0" cellpadding="0"> <tr> <td width="<?php echo $this->_vars['setting']['titleImgWidth']; ?>"><?php echo $this->_env_vars['capture']['titleImg']; ?></td> <td><div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['goodsLoop']; ?> </div> </td> </tr> </table> <?php }elseif( $this->_vars['setting']['titleImgPosition']=="right" ){ ?> <table width="100%" border="0" cellspacing="0" cellpadding="0"> <tr> <td><div class="GoodsList"> <?php echo $this->_env_vars['capture']['goodsCat'];  echo $this->_env_vars['capture']['goodsLoop']; ?> </div> </td> <td width="<?php echo $this->_vars['setting']['titleImgWidth']; ?>"><?php echo $this->_env_vars['capture']['titleImg']; ?></td> </tr> </table> <?php }  if( $this->_vars['setting']['showMore'] == "on" && $this->_vars['data']['link'] ){ ?> <div class="more clearfix"><a href="<?php echo $this->_vars['data']['link']; ?>">更多...</a></div> <?php } ?> </div> 